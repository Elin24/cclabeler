name: Deploy the app to ovhai container
on:
  push:
    branches:
      - feat/cli

env:
  OVH_REGION: GRA
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Install ovhai command
        run: |
          wget https://cli.${{ env.OVH_REGION }}.training.ai.cloud.ovh.net/ovhai-linux.zip
          unzip ovhai-linux.zip
          mkdir -p $HOME/bin
          mv ovhai $HOME/bin/ovhai
          echo "$PATH:$HOME/bin/" >> $GITHUB_PATH
      - name: Login to ovhai
        run: |
          ovhai login -p ${{ secrets.OVH_PSWD }} -u ${{ secrets.OVH_USER }}
      - name: Deploy to ovhai
        id: deploy
        run: |
          ovhai job run --default-http-port 8000 --cpu 4 ghcr.io/datalab-mi/cclabeler:feat-cli
          echo "::set-output name=URL::https://ovh.com\n"
      - name: get url
        run: echo ${{ steps.deploy.outputs.URL }}
